---
  - name: install yum dependencies
    yum:
      name: 'git'
      state: latest
    become: yes

  - name: clone the repo
    git:
      repo: 'https://github.com/jaypoulz/verification-tests.git'
      version: jaypoulz-gpg-rhel7-fix-minimal
      dest: verification-tests

  - name: install OS dependencies
    shell:
      chdir: verification-tests
      cmd: './tools/install_os_deps.sh'
    ignore_errors: yes
    become: yes

  - name: installs modules based on the contents of bushslicer/Gemfile
    shell:
      chdir: verification-tests
      cmd: 'bash -lc "rvm --default use 2.4 && ruby tools/hack_bundle.rb"'
    become: yes

  - name: copies an arch-specific geckodriver onto the execution path
    copy:
      src: "{{ playbook_dir }}/bin/geckodriver-v0.24.0/{{ ansible_architecture }}/rhel/geckodriver"
      dest: /usr/local/bin/geckodriver
      owner: root
      group: root
      mode: 0751
    become: yes
