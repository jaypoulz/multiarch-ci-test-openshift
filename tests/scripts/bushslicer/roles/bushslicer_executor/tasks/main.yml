---
  - name: install yum dependencies
    yum:
      name: 'git'
      state: latest
    become: yes

  - name: clone the repo
    git:
      repo: 'https://github.com/jaypoulz/verification-tests.git'
      version: jaypoulz-gpg-rhel7-fix-minimal
      dest: verification-tests

  - name: install OS dependencies
    shell:
      chdir: verification-tests
      cmd: './tools/install_os_deps.sh'
    ignore_errors: yes
    become: yes

  - name: add the test user to the rvm group
    user:
      name: test
      groups: rvm
      append: yes

  - name: installs modules based on the contents of bushslicer/Gemfile
    shell:
      chdir: verification-tests
      cmd: 'bash -lc "ruby tools/hack_bundle.rb"'

  - name: copies an arch-specific geckodriver onto the execution path
    copy:
      src: "{{ playbook_dir }}/bin/geckodriver-v0.24.0/{{ ansible_architecture }}/rhel/geckodriver"
      dest: /usr/local/bin/geckodriver
      owner: root
      group: root
      mode: 0755
    become: yes
